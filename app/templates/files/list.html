{% extends "base.html" %}
{% block title %}Мои файлы{% endblock %}

{% block content %}
  <h1>Файлы</h1>
  <a class="btn btn-success mb-3" href="{{ url_for('main.upload_file') }}">Загрузить новый файл</a>

  {% if pagination.items %}
  <table class="table">
    <thead>
      <tr><th>#</th><th>Имя</th><th>Размер</th><th>Видимость</th><th>Дата</th><th></th></tr>
    </thead>
    <tbody>
      {% for f in pagination.items %}
        <tr>
          <td>{{ f.id }}</td>
          <td>{{ f.original_name }}</td>
          <td>{{ (f.size_bytes // 1024) }} KB</td>
          <td>{{ f.visibility }}</td>
          <td>{{ f.created_at.strftime("%d.%m.%Y %H:%M") }}</td>
          <td>
            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('main.download_file', file_id=f.id) }}">Скачать</a>
            {% if current_user.has_role('admin') %}
              <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('admin.edit_file', file_id=f.id) }}">Редактировать</a>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
    <p>Файлов нет.</p>
  {% endif %}

  {# пагинация #}
  {% if pagination.pages > 1 %}
  <nav>
    <ul class="pagination">
      {% if pagination.has_prev %}
        <li class="page-item"><a class="page-link" href="{{ url_for('main.user_files', page=pagination.prev_num) }}">Prev</a></li>
      {% endif %}
      {% for p in range(1, pagination.pages+1) %}
        <li class="page-item {% if p==pagination.page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('main.user_files', page=p) }}">{{ p }}</a>
        </li>
      {% endfor %}
      {% if pagination.has_next %}
        <li class="page-item"><a class="page-link" href="{{ url_for('main.user_files', page=pagination.next_num) }}">Next</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}

{% endblock %}
